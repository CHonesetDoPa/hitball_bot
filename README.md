# 击打机
群友太嚣张了，忍不了了，怎么办？

还好，聪明的CC发明了击打机！它可以让你合法地暴打群友！

• 优点
  ◦ 不用真的动手，但是效果拔群
  ◦ 自动统计战绩，让你知道谁最抗揍
  ◦ 防止自残，毕竟打自己是没意义的
  ◦ 数据持久化，重启也不会丢失你的光辉战绩

• 缺点
  ◦ 只能线上击打，无法造成真实伤害
  ◦ 可能会让群友记恨你

## 使用效果

我们先来打个人试试吧！

```
用户A: /hit @用户B
```

```
💥 用户A 给了 @用户B 一记重拳！
📊 @用户B 已被击打 5 次！
```

看起来效果不错，用户B被揍得挺惨的！

再看看排行榜——

```
/leaderboard
```

```
🏆 击打排行榜 🏆
🥇 @用户B - 5 次
🥈 @用户E - 3 次  
🥉 @用户F - 2 次
```

用户B果然是抗击打冠军！

好，接下来我们来查看一下统计数据——

```
/stats @用户B
```

```
📊 击打统计报告
@用户B 已被击打 5 次！
```

数据记录得很详细呢！

## 原理

其实原理非常简单。群友在群里说话的时候，你回复他们的消息然后发送 `/hit`，机器人就会记录下这次击打。

### 数据存储

举个例子，张三被打了，机器人会在 `data.json` 里记录：

```json
{
  "hitData": {
    "张三的ID": {
      "name": "张三",
      "count": 1
    }
  }
}
```

下次张三又被打了，`count` 就会变成 2。就这么简单！

### 排行榜生成

每次有人查看排行榜的时候，机器人就把所有人的击打次数拿出来排个序，然后显示前几名。

机器学习？不需要。神经网络？也不需要。就是个简单的计数器而已！

## 使用方法

首先你需要有一个Telegram账号，然后找到 [@BotFather](https://t.me/botfather) 创建一个机器人。

获得token之后，把这个仓库clone回去，在 `.env` 文件里填入你的token，然后 `pnpm install && pnpm start`，就行了。

### 命令接口

```
/hit @用户名       # 击打某人
/stats            # 查看自己的统计，或 /stats @用户名 查看他人  
/leaderboard      # 查看排行榜
/achievements     # 查看成就，或 /achievements @用户名 查看他人成就
/help             # 获取帮助信息
```

### 新功能特性

#### 🚦 智能速率限制与反垃圾机制
- **击打命令**: 3秒冷却时间，防止恶意刷屏
- **其他命令**: 1秒冷却时间，防止频繁请求
- **自动禁言**: 连续违规触发冷却5次后，自动禁言5分钟
- **智能计数**: 违规计数会在1分钟后自动重置

#### 🛡️ 机器人保护机制
- **攻击反弹**: 试图攻击机器人的用户会被反弹攻击
- **自动反击**: 攻击者自己的高玩会受到反弹伤害
- **反击成就**: 首次攻击机器人会解锁"机器人挑战者"成就
- **数据统计**: 反弹攻击会计入正常的高玩击打统计中

#### 🔒 群聊命令限制
- **群聊环境**: 只允许使用 `/hit` 命令，保持群聊简洁
- **私聊环境**: 无限制，可使用所有功能
- 在群聊中使用受限命令会提示私聊机器人

#### ⚙️ 环境变量配置

在 `.env` 文件中可以自定义设置:

```env
# 必需配置
BOT_TOKEN=your_bot_token_here
BOT_USERNAME=your_bot_username_here

# 可选：速率限制配置（毫秒）
HIT_COOLDOWN=3000      # 击打命令冷却时间，默认3秒
COMMAND_COOLDOWN=1000  # 其他命令冷却时间，默认1秒

# 可选：反垃圾配置
MAX_VIOLATIONS=5       # 最大违规次数，默认5次
MUTE_TIME=300         # 禁言时间（秒），默认5分钟
VIOLATION_RESET_TIME=60000  # 违规计数重置时间（毫秒），默认1分钟
```

### 使用场景

1. **群聊击打**: 在群聊中回复某人消息并发送 `/hit`，或使用 `/hit @用户名`
2. **数据查询**: 私聊机器人使用 `/stats`、`/leaderboard`、`/achievements` 等命令
3. **成就系统**: 不同的击打次数会解锁特殊成就和称号

## 结束

这是一个狠命击打你ball的bot，现在还带有智能限制和群聊优化功能！
